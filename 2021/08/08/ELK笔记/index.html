<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>ELK | Hexo</title>

  
    
<link rel="stylesheet" href="/js/aos/aos.css">

  

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  
    <script>
        var themeModelId = '';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    
        <script src="/js/valine/av-min@3.0.4.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js"></script>
    
<meta name="generator" content="Hexo 5.4.0"></head>

  
  <!-- 依赖于jquery和vue -->
  <script src="/js/jquery3.5.1.js"></script>
  <script src="/js/vue2.6.11.js"></script>
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="/js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">loading...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 头部导航等 -->
    
<header class="header " id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fa fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo" src="/medias/logo.png" alt="logo">
      <h3 class="drawer-box-head_title">Hexo</h3>
      <h5 class="drawer-box-head_desc"></h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fa fa-home" aria-hidden="true"></i>
                  
                  <span class="name">主页</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fa fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fa fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fa fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/about" class="drawer-menu-item-link">
                  
                    <i class="fa fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/friends" class="drawer-menu-item-link">
                  
                  <span class="name">Friends</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(6)">
                  <span>
                    
                      <i class="fa fa-link"></i>
                    
                    <span class="name">更多</span>
                  </span>
                  <i class="fa fa-chevron-left arrow " :class="{'icon-rotate': isOpen(6)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(6)">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fa fa-music" style="margin-top: -20px;"></i>
                      
                      <span>图库</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>友情连接</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>关于我</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/yuang01/hexo-theme-bamboo">
              <i class="fa fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/logo.png" alt="logo">
        </div>
      
      <a href="/" class="logo">Hexo</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="主页">
                  
                    <i class="fa fa-home" aria-hidden="true"></i>
                  
                  <span class="name">主页</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="归档">
                  
                    <i class="fa fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="Tags">
                  
                    <i class="fa fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="Categories">
                  
                    <i class="fa fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/about" class="menu-item-link" title="About">
                  
                    <i class="fa fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/friends" class="menu-item-link" title="Friends">
                  
                  <span class="name">Friends</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="更多">
                  
                    <i class="fa fa-link"></i>
                  
                  <span class="name">更多</span>
                  <i class="fa fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fa fa-music" style="margin-top: -20px;"></i>
                      
                      <span>图库</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>友情连接</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>关于我</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fa fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <!-- <div class="close" style="overflow: hidden;">
          <i class="fa fa-close" aria-hidden="true" style="float:right;" @click.self="cancelDialogVisible()"></i>
        </div> -->
        <h2>
          <span>
            <i class="fa fa-search" aria-hidden="true"></i>
            <span class="title">Search</span>
          </span>
          <i class="fa fa-close close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="Please enter keywords"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/yuang01/hexo-theme-bamboo" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  

    <!-- 当头部导航设置为背景透明的时候  -->
    
      <script src="/js/header/index.js" data-pjax></script>
    
</header>

    <!-- 需要在上面加载的js -->
    <script>
    function loadScript(src, cb) {
        setTimeout(function () {
            var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
            var script = document.createElement('script');
            script.setAttribute('type', 'text/javascript');
            if (cb) script.onload = cb;
            script.setAttribute('src', src);
            HEAD.appendChild(script);
        });
    }

    //https://github.com/filamentgroup/loadCSS
    var loadCSS = function (href, before, media, attributes) {
        var doc = window.document;
        var ss = doc.createElement("link");
        var ref;
        if (before) {
            ref = before;
        }
        else {
            var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
            ref = refs[refs.length - 1];
        }
        var sheets = doc.styleSheets;
        if (attributes) {
            for (var attributeName in attributes) {
                if (attributes.hasOwnProperty(attributeName)) {
                    ss.setAttribute(attributeName, attributes[attributeName]);
                }
            }
        }
        ss.rel = "stylesheet";
        ss.href = href;
        ss.media = "only x";
        function ready(cb) {
            if (doc.body) {
                return cb();
            }
            setTimeout(function () {
                ready(cb);
            });
        }
        ready(function () {
            ref.parentNode.insertBefore(ss, (before ? ref : ref.nextSibling));
        });
        var onloadcssdefined = function (cb) {
            var resolvedHref = ss.href;
            var i = sheets.length;
            while (i--) {
                if (sheets[i].href === resolvedHref) {
                    return cb();
                }
            }
            setTimeout(function () {
                onloadcssdefined(cb);
            });
        };
        function loadCB() {
            if (ss.addEventListener) {
                ss.removeEventListener("load", loadCB);
            }
            ss.media = media || "all";
        }
        if (ss.addEventListener) {
            ss.addEventListener("load", loadCB);
        }
        ss.onloadcssdefined = onloadcssdefined;
        onloadcssdefined(loadCB);
        return ss;
    };
    
</script>
 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <!-- 内容区域 -->
    <main class="main" id="pjax-container" style="margin-top: 0;">
      
 <!-- prismjs 代码高亮 -->
 


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>

<!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header lazyload" id="thumbnail_canvas" data-original="/medias/11.jpg" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        ELK
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fa fa-calendar"></i> Published in：2021-08-08 |
        </span>
      

      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>



<div class="row justify-position">
  <div class="main-content">
    <article class="post post-detail">
      
      <div class="post-content">
        <h2 id="第一章-ES简介"><a href="#第一章-ES简介" class="headerlink" title="第一章 ES简介"></a>第一章 ES简介</h2><h3 id="第1节-ES介绍"><a href="#第1节-ES介绍" class="headerlink" title="第1节 ES介绍"></a>第1节 ES介绍</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、Elasticsearch是一个基于Lucene的搜索服务器</span><br><span class="line">2、提供了一个分布式的全文搜索引擎,基于restful web接口</span><br><span class="line">3、Elasticsearch是用Java语言开发的，基于Apache协议的开源项目，是目前最受欢迎的企业搜索引擎</span><br><span class="line">4、Elasticsearch广泛运用于云计算中，能够达到实时搜索，具有稳定，可靠，快速的特点</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="第2节-ES版本"><a href="#第2节-ES版本" class="headerlink" title="第2节 ES版本"></a>第2节 ES版本</h3><ul>
<li><p>版本历史</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES : 1.x ---&gt; 2.x ---&gt; 5.x ---&gt; 6.x ---&gt;7.x（目前）</span><br></pre></td></tr></table></figure></li>
<li><p>版本选择</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在版本选择一般选择5.x版本以上,我们本课程的学习使用6.x版本,低版本会随着官网的不断推动,在未来可能就不维护了,所以在选择的时候要尽量选择目前来说一个长期的稳定版本</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="第二章-安装-v6-3-2"><a href="#第二章-安装-v6-3-2" class="headerlink" title="第二章 安装(v6.3.2)"></a>第二章 安装(v6.3.2)</h2><h3 id="第1节-window下单点安装ES"><a href="#第1节-window下单点安装ES" class="headerlink" title="第1节 window下单点安装ES"></a>第1节 window下单点安装ES</h3><ul>
<li><p>下载地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">官网地址:</span><br><span class="line">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.3.1.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">华为镜像站:</span><br><span class="line">https://mirrors.huaweicloud.com/elasticsearch/6.3.2/elasticsearch-6.3.2.zip</span><br></pre></td></tr></table></figure></li>
<li><p>安装步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、将下载的安装包解压到指定目录下(不能有中文)</span><br><span class="line">2、找到目录下的bin目录(比如: D:\soft\elasticsearch-6.3.2\bin)</span><br><span class="line">3、bin目录下有一个[elasticsearch.bat]脚本命令,直接鼠标双击即可,启动ES服务</span><br></pre></td></tr></table></figure></li>
<li><p>访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ES服务的默认端口号为 9200,在浏览器访问 http://localhost:9200/ 浏览器就会输出下面信息,安装成功</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;G7lh1eQ&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;4T38-ecWQ5O8OpIM3RibAw&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;6.3.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;zip&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;053779d&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2018-07-20T05:20:23.451332Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;7.3.1&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第2节-window下安装Head插件"><a href="#第2节-window下安装Head插件" class="headerlink" title="第2节 window下安装Head插件"></a>第2节 window下安装Head插件</h3><h4 id="2-1-Head插件介绍"><a href="#2-1-Head插件介绍" class="headerlink" title="2.1 Head插件介绍"></a>2.1 Head插件介绍</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">是一款能连接ES,并提供对ES进行操作的可视化界面</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="2-2-Head插件下载地址"><a href="#2-2-Head插件下载地址" class="headerlink" title="2.2 Head插件下载地址"></a>2.2 Head插件下载地址</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/mobz/elasticsearch-head/archive/master.zip</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="2-3-安装步骤"><a href="#2-3-安装步骤" class="headerlink" title="2.3 安装步骤"></a>2.3 安装步骤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1. 电脑首先要安装node.js,因为安装Head插件需要使用npm命令</span><br><span class="line"></span><br><span class="line">注意: 由于npm命令使用的是国外的镜像库,所以可能会很慢或者发生失败的情况,可以有两种方式解决</span><br><span class="line">    方式一: 切换镜像地址</span><br><span class="line">        -- 查看当前npm的镜像地址: npm config get registry</span><br><span class="line">            -- 默认地址为: https://registry.npmjs.org/</span><br><span class="line">        -- 将默认镜像地址设置成淘宝的地址: npm config set registry https://registry.npm.taobao.org</span><br><span class="line">    方式二: 使用cnpm</span><br><span class="line">        -- 下载cnpm并且同时设置镜像源命令 npm install cnpm -g --registry=https://registry.npm.taobao.org</span><br><span class="line">        -- 使用cnpm -v查看</span><br><span class="line">        -- 以后使用cnpm 命令安装依赖</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">2. nodejs安装好之后,那么开始解压head插件压缩包</span><br><span class="line">3. 切换到解压文件目录下 D:\soft\elasticsearch-head-master,我的解压到了d盘soft目录下</span><br><span class="line">4. 使用cmd命令行工具切换到解压目录下,执行命令 npm install 安装</span><br><span class="line">5. 安装完成之后启动head插件 npm run start 这时候就会在在计算机9100端口号上启动服务</span><br><span class="line">6. 在浏览器访问,在浏览器中输入 http://localhost:9100/ 访问</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB2d64f18a535bcc41fa2525377deef953?method=download&shareKey=01bc3a0de15bcb0beff502ae379e4f99"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB2d64f18a535bcc41fa2525377deef953?method=download&shareKey=01bc3a0de15bcb0beff502ae379e4f99" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h4 id="2-4-Head插件和ES关联配置"><a href="#2-4-Head插件和ES关联配置" class="headerlink" title="2.4 Head插件和ES关联配置"></a>2.4 Head插件和ES关联配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为两个服务之间可能ip地址和端口号不同造成跨域的问题,所以需要配置可以跨域</span><br></pre></td></tr></table></figure>

<ul>
<li><p>修改ES的配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、因为ES和Head插件之间是两个不同的服务,所以需要进行配置</span><br><span class="line">    - 1.1 修改ES的配置,找到我们的ES配置文件 elasticsearch-6.3.2\config\elasticsearch.yml</span><br><span class="line">    - 1.2 在文件的最后一行设置一个可以进行跨域访问的属性</span><br><span class="line">        http:</span><br><span class="line">            cors:</span><br><span class="line">                enabled: true</span><br><span class="line">                allow-origin: &quot;*&quot;</span><br><span class="line">    - 1.3 重启ES服务,重启Head服务</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第3节-window-ES-集群安装"><a href="#第3节-window-ES-集群安装" class="headerlink" title="第3节 window ES 集群安装"></a>第3节 window ES 集群安装</h3><h4 id="3-1-集群配置步骤"><a href="#3-1-集群配置步骤" class="headerlink" title="3.1 集群配置步骤"></a>3.1 集群配置步骤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 创建一个elasticsearch-cluster文件夹</span><br><span class="line">2. 解压我们的elasticsearch-6.3.2.zip压缩包到elasticsearch-cluster目录下</span><br><span class="line">3. 分别命名为 elasticsearch-node01,elasticsearch-node02,elasticsearch-node03</span><br><span class="line">4. 修改配置文件</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="3-2-配置文件编写"><a href="#3-2-配置文件编写" class="headerlink" title="3.2 配置文件编写"></a>3.2 配置文件编写</h4><ul>
<li><p>elasticsearch-node01节点配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称，保证唯一</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line"># 节点名称，每个节点不能相同</span><br><span class="line">node.name: node-01</span><br><span class="line"># 本机的ip地址</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># 服务端口号，在同一机器下端口号不能相同</span><br><span class="line">http.port: 9200</span><br><span class="line"># 集群间通信端口号，在同一机器下端口号不能相同</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line"># 设置集群自动发现机器ip集合</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]</span><br><span class="line"># 跨域调用</span><br><span class="line">http:</span><br><span class="line">  cors:</span><br><span class="line">      enabled: true</span><br><span class="line">      allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>elasticsearch-node02节点配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称，保证唯一</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line"># 节点名称，每个节点不能相同</span><br><span class="line">node.name: node-02</span><br><span class="line"># 本机的ip地址</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># 服务端口号，在同一机器下端口号不能相同</span><br><span class="line">http.port: 9201</span><br><span class="line"># 集群间通信端口号，在同一机器下端口号不能相同</span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line"># 设置集群自动发现机器ip集合</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]</span><br><span class="line"># 跨域调用</span><br><span class="line">http:</span><br><span class="line">  cors:</span><br><span class="line">      enabled: true</span><br><span class="line">      allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>elasticsearch-node03节点配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称，保证唯一</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line"># 节点名称，每个节点不能相同</span><br><span class="line">node.name: node-03</span><br><span class="line"># 本机的ip地址</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># 服务端口号，在同一机器下端口号不能相同</span><br><span class="line">http.port: 9202</span><br><span class="line"># 集群间通信端口号，在同一机器下端口号不能相同</span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line"># 设置集群自动发现机器ip集合</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]</span><br><span class="line"># 跨域调用</span><br><span class="line">http:</span><br><span class="line">  cors:</span><br><span class="line">      enabled: true</span><br><span class="line">      allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">重启各个节点</span><br><span class="line"></span><br><span class="line">注意: 如果在重启各个节点时出现点击启动脚本闪退的问题,可能造成的原因是配置文件需要使用UTF-8编码的格式编写</span><br><span class="line">解决方式,使用notepad++修改当前配置文件的编码格式为utf-8</span><br><span class="line"></span><br><span class="line">重启Head服务</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBa082370d84f533e37e4ea5b917d8d4ca?method=download&shareKey=96eaf03ba8681704ff296f21539d814a"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBa082370d84f533e37e4ea5b917d8d4ca?method=download&shareKey=96eaf03ba8681704ff296f21539d814a" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 图中黑色的粗框代表这分片</span><br><span class="line">2. 细的黑框代表着副本</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="第三章-基础概念"><a href="#第三章-基础概念" class="headerlink" title="第三章 基础概念"></a>第三章 基础概念</h2><h3 id="第1节-索引"><a href="#第1节-索引" class="headerlink" title="第1节 索引"></a>第1节 索引</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">含有相同属性的文档集合,相当于我们MYSQL数据库中的数据库(DATABASE)</span><br></pre></td></tr></table></figure>

<h3 id="第2节-类型"><a href="#第2节-类型" class="headerlink" title="第2节 类型"></a>第2节 类型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">索引可以定义一个或多个类型(ES6中已经逐步弃用,在更高的7版本中已经删除),文档必须属于一个类型,相当于我们MYSQL中的一个表(TABLE)</span><br></pre></td></tr></table></figure>

<h3 id="第3节-文档"><a href="#第3节-文档" class="headerlink" title="第3节 文档"></a>第3节 文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文档是可以被索引的基本数据单位,相当于MYSQL数据库表中的一行记录</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="第4节-分片-副本-备份"><a href="#第4节-分片-副本-备份" class="headerlink" title="第4节 分片/副本(备份)"></a>第4节 分片/副本(备份)</h3><ul>
<li><p>分片(shard)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 每个索引有一个或多个分片</span><br><span class="line">2. 索引的数据被分配到各个分片上,相当于一桶水使用多个杯子去装,分片有助于横向扩展</span><br><span class="line">3. 如果将大量的数据保存到一个分片里面,那么分片越来越大数据越来越多,查找性能越来越差</span><br><span class="line">4. 默认情况下一个索引创建5个分片</span><br><span class="line">5. 分片会默认的分配到es集群的各个节点上,集群自动完成</span><br></pre></td></tr></table></figure></li>
<li><p>副本(replica)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 副本,可以理解为分片的备份</span><br><span class="line">2. 主分片和副本(备分片)不会出现在同一个节点上(防止单点故障)默认情况下一个索引创建5个分片一个备份(5个主分片+5个副本分片=10个分片)</span><br><span class="line">3. 如果只有一个es节点,那么replica就无法分配(因为主/副不能同在一个节点上),此时cluster status会变成Yellow</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="第四章-基本用法"><a href="#第四章-基本用法" class="headerlink" title="第四章 基本用法"></a>第四章 基本用法</h2><h3 id="第1节-ES-的-RESTFul-API"><a href="#第1节-ES-的-RESTFul-API" class="headerlink" title="第1节 ES 的 RESTFul API"></a>第1节 ES 的 RESTFul API</h3><ul>
<li><p>API的基本格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://&lt;ip&gt;:&lt;port&gt;/&lt;索引&gt;/&lt;类型&gt;/&lt;文档id&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>常用的HTTP动作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET/POST/PUT/DELETE</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第2节-创建索引"><a href="#第2节-创建索引" class="headerlink" title="第2节 创建索引"></a>第2节 创建索引</h3><h4 id="2-1-使用Head插件创建索引"><a href="#2-1-使用Head插件创建索引" class="headerlink" title="2.1 使用Head插件创建索引"></a>2.1 使用Head插件创建索引</h4><ul>
<li><p>创建索引的步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 登陆Head页面</span><br><span class="line">2. 找到索引标签</span><br><span class="line">3. 新建索引</span><br><span class="line">4. 添加索引名称(英文,全部都是小写字母,不能用下划线开头)</span><br><span class="line">5. 索引创建成功之后回到概览页面就会在上面发现我们新建的索引</span><br></pre></td></tr></table></figure></li>
<li><p>Head页面展示</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB0c2cf6c12beac90cf956da8adddb81e1?method=download&shareKey=fc77913e32aa18f22010089bfe7f9888"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB0c2cf6c12beac90cf956da8adddb81e1?method=download&shareKey=fc77913e32aa18f22010089bfe7f9888" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h4 id="2-2-结构化索引-非结构化索引"><a href="#2-2-结构化索引-非结构化索引" class="headerlink" title="2.2 结构化索引/非结构化索引"></a>2.2 结构化索引/非结构化索引</h4><ul>
<li>结构化和非结构化介绍</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">进入我们的Head界面,进入概览,点击索引名称下面的信息,点击索引信息,查看数据里面有一个mappings属性,内容为空,说明我们此索引为非结构化索引</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;state&quot;: &quot;open&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;creation_date&quot;: &quot;1597547149325&quot;,</span><br><span class="line">            &quot;number_of_shards&quot;: &quot;5&quot;,</span><br><span class="line">            &quot;number_of_replicas&quot;: &quot;1&quot;,</span><br><span class="line">            &quot;uuid&quot;: &quot;UvYCPtp0TZeCiPexCT517g&quot;,</span><br><span class="line">            &quot;version&quot;: &#123;</span><br><span class="line">                &quot;created&quot;: &quot;6030299&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;provided_name&quot;: &quot;book&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;mappings&quot;: &#123;&#125;,</span><br><span class="line">    &quot;aliases&quot;: [],</span><br><span class="line">    &quot;primary_terms&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: 1,</span><br><span class="line">        &quot;1&quot;: 1,</span><br><span class="line">        &quot;2&quot;: 1,</span><br><span class="line">        &quot;3&quot;: 1,</span><br><span class="line">        &quot;4&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;in_sync_allocations&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: [</span><br><span class="line">            &quot;BHBNGrGCSiOl-wuKptvGtQ&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;1&quot;: [</span><br><span class="line">            &quot;yMyL9GsMR9SziVr9OK_Uxw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;2&quot;: [</span><br><span class="line">            &quot;b8EGEtGlTySAqvlKPtW_EA&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;3&quot;: [</span><br><span class="line">            &quot;0azU6MwTSCqMdzVXyuPVrw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;4&quot;: [</span><br><span class="line">            &quot;DY2oxeUuSNaxva5dgKTSAg&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>结构化和非结构化转化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、在当前的head页面中点击【复合查询】</span><br><span class="line">2、调用ES的API构建一个请求url</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我这里给book索引添加一个author类型,使用_mappings关键字(ES给索引、类型、文档等起名字时不能以下划线开头,因为ES中很多关键字都是以下划线开头的)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB0c166f9aba64029505e80c6bf21063d5?method=download&shareKey=4afba56edf5792ceb65836c108d060d1"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB0c166f9aba64029505e80c6bf21063d5?method=download&shareKey=4afba56edf5792ceb65836c108d060d1" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">3、给上面的非结构化索引添加一些结构化的数据,让他变成结构化索引</span><br><span class="line"></span><br><span class="line">点击易读,点击验证json,防止自己写的json数据有问题,点击提交请求</span><br><span class="line"></span><br><span class="line">properties: 关键字,设置属性</span><br><span class="line">type: 关键字,设置属性类型</span><br><span class="line">&#123;</span><br><span class="line">    &quot;author&quot;: &#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;author_name&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4、添加成功标志</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;acknowledged&quot;: true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">5、在进入概览点击索引信息查看数据(mappings中就有了机构化数据)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;state&quot;: &quot;open&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;creation_date&quot;: &quot;1597547149325&quot;,</span><br><span class="line">            &quot;number_of_shards&quot;: &quot;5&quot;,</span><br><span class="line">            &quot;number_of_replicas&quot;: &quot;1&quot;,</span><br><span class="line">            &quot;uuid&quot;: &quot;UvYCPtp0TZeCiPexCT517g&quot;,</span><br><span class="line">            &quot;version&quot;: &#123;</span><br><span class="line">                &quot;created&quot;: &quot;6030299&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;provided_name&quot;: &quot;book&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">        &quot;author&quot;: &#123;</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;author_name&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;text&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;aliases&quot;: [],</span><br><span class="line">    &quot;primary_terms&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: 1,</span><br><span class="line">        &quot;1&quot;: 1,</span><br><span class="line">        &quot;2&quot;: 1,</span><br><span class="line">        &quot;3&quot;: 1,</span><br><span class="line">        &quot;4&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;in_sync_allocations&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: [</span><br><span class="line">            &quot;BHBNGrGCSiOl-wuKptvGtQ&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;1&quot;: [</span><br><span class="line">            &quot;yMyL9GsMR9SziVr9OK_Uxw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;2&quot;: [</span><br><span class="line">            &quot;b8EGEtGlTySAqvlKPtW_EA&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;3&quot;: [</span><br><span class="line">            &quot;0azU6MwTSCqMdzVXyuPVrw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;4&quot;: [</span><br><span class="line">            &quot;DY2oxeUuSNaxva5dgKTSAg&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="2-3-使用postman创建索引"><a href="#2-3-使用postman创建索引" class="headerlink" title="2.3 使用postman创建索引"></a>2.3 使用postman创建索引</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Head在进行结构化数据创建的时候,验证json数据格式比较麻烦,我们可以使用postman进行结构化数据创建</span><br></pre></td></tr></table></figure>

<ul>
<li>使用postman创建索引</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB683927128dabde2d93183a9839113a19?method=download&shareKey=17d48375b6fb130cf6a2a8fae5ad78ae"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB683927128dabde2d93183a9839113a19?method=download&shareKey=17d48375b6fb130cf6a2a8fae5ad78ae" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<ul>
<li><p>postman创建索引的请求数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;settings&quot;:&#123;</span><br><span class="line">		&quot;number_of_shards&quot;:5,</span><br><span class="line">		&quot;number_of_replicas&quot;:1</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;mappings&quot;:&#123;</span><br><span class="line">		&quot;man&quot;:&#123;</span><br><span class="line">			&quot;properties&quot;:&#123;</span><br><span class="line">				&quot;name&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;text&quot;</span><br><span class="line">				&#125;,</span><br><span class="line">				&quot;country&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">				&#125;,</span><br><span class="line">				&quot;age&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;integer&quot;</span><br><span class="line">				&#125;,</span><br><span class="line">				&quot;date&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;date&quot;,</span><br><span class="line">					&quot;format&quot;:&quot;yyyy-MM-dd HH:mm:ss || yyyy-MM-dd || epoch_millis&quot;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------------参数变量的简单介绍----------------------------------</span><br><span class="line"></span><br><span class="line">settings     : 设置当前索引的基本信息</span><br><span class="line">mappings     : 结构化索引配置</span><br><span class="line">format       : 时间格式</span><br><span class="line">epoch_millis : 时间戳(毫秒数)</span><br></pre></td></tr></table></figure></li>
<li><p>head页面查看创建结果</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBee0114c334d559485567119c623a2dad?method=download&shareKey=a95876df2e512b7cc8c16e13987ee2f9"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBee0114c334d559485567119c623a2dad?method=download&shareKey=a95876df2e512b7cc8c16e13987ee2f9" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h3 id="第3节-数据插入-postman"><a href="#第3节-数据插入-postman" class="headerlink" title="第3节 数据插入(postman)"></a>第3节 数据插入(postman)</h3><h4 id="3-1-指定id插入"><a href="#3-1-指定id插入" class="headerlink" title="3.1 指定id插入"></a>3.1 指定id插入</h4><ul>
<li><p>请求地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1</span><br></pre></td></tr></table></figure></li>
<li><p>请求图例</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBe4650dca8d5e767b5c38e3aae96fcfb8?method=download&shareKey=24e1c1fb034f90e2864c177bf04adcc9"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBe4650dca8d5e767b5c38e3aae96fcfb8?method=download&shareKey=24e1c1fb034f90e2864c177bf04adcc9" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<ul>
<li><p>添加数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;name&quot;:&quot;枫桥夜泊1990&quot;,</span><br><span class="line">	&quot;country&quot;:&quot;中国&quot;,</span><br><span class="line">	&quot;age&quot;:30,</span><br><span class="line">	&quot;date&quot;:&quot;1990-05-28&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>返回结果数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;_index&quot;: &quot;people&quot;,</span><br><span class="line">    &quot;_type&quot;: &quot;man&quot;,</span><br><span class="line">    &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;_version&quot;: 1,</span><br><span class="line">    &quot;result&quot;: &quot;created&quot;,</span><br><span class="line">    &quot;_shards&quot;: &#123;</span><br><span class="line">        &quot;total&quot;: 2,</span><br><span class="line">        &quot;successful&quot;: 1,</span><br><span class="line">        &quot;failed&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;_seq_no&quot;: 0,</span><br><span class="line">    &quot;_primary_term&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>head查看</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB17d3c1815c1f6335f58e6cc3ab639c95?method=download&shareKey=39b22c3ba6c84b8eca4bc2d1c9a91d9a"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB17d3c1815c1f6335f58e6cc3ab639c95?method=download&shareKey=39b22c3ba6c84b8eca4bc2d1c9a91d9a" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB1345141a8ddfc83fcc6041722d643f50?method=download&shareKey=90d6b0efc383fb4469e018856c88ce14"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB1345141a8ddfc83fcc6041722d643f50?method=download&shareKey=90d6b0efc383fb4469e018856c88ce14" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h4 id="3-2-自动生成id插入"><a href="#3-2-自动生成id插入" class="headerlink" title="3.2 自动生成id插入"></a>3.2 自动生成id插入</h4><ul>
<li><p>请求地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/</span><br></pre></td></tr></table></figure></li>
<li><p>请求图例</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB4e77001ccee3d6d92fa15f6845633e07?method=download&shareKey=40f9a78a2a99ca8736c0878788a265c9"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB4e77001ccee3d6d92fa15f6845633e07?method=download&shareKey=40f9a78a2a99ca8736c0878788a265c9" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<ul>
<li>head查看</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBf58551398ea8893d0597e9dfe036af22?method=download&shareKey=9f4fb0be48d86ac1e3e9cd164ecc7c85"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBf58551398ea8893d0597e9dfe036af22?method=download&shareKey=9f4fb0be48d86ac1e3e9cd164ecc7c85" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h3 id="第4节-数据修改-postman"><a href="#第4节-数据修改-postman" class="headerlink" title="第4节 数据修改(postman)"></a>第4节 数据修改(postman)</h3><h4 id="4-1-直接修改文档"><a href="#4-1-直接修改文档" class="headerlink" title="4.1 直接修改文档"></a>4.1 直接修改文档</h4><ul>
<li><p>请求地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1/_update</span><br></pre></td></tr></table></figure></li>
<li><p>请求参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;doc&quot;:&#123;</span><br><span class="line">		&quot;name&quot;:&quot;我是枫桥夜泊1990&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>请求图例</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBd3858fb3757aa53933f2685438ac164a?method=download&shareKey=23f43294ac1bf8f1586e7477a4d8f0e8"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBd3858fb3757aa53933f2685438ac164a?method=download&shareKey=23f43294ac1bf8f1586e7477a4d8f0e8" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<ul>
<li><p>响应数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;_index&quot;: &quot;people&quot;,</span><br><span class="line">    &quot;_type&quot;: &quot;man&quot;,</span><br><span class="line">    &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;_version&quot;: 2,</span><br><span class="line">    &quot;result&quot;: &quot;updated&quot;,</span><br><span class="line">    &quot;_shards&quot;: &#123;</span><br><span class="line">        &quot;total&quot;: 2,</span><br><span class="line">        &quot;successful&quot;: 1,</span><br><span class="line">        &quot;failed&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;_seq_no&quot;: 2,</span><br><span class="line">    &quot;_primary_term&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>head查看</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBe1473018a3c715b72bac6929720e407c?method=download&shareKey=5fcfca82d7e93c7e32359dc4b5c62c5f"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBe1473018a3c715b72bac6929720e407c?method=download&shareKey=5fcfca82d7e93c7e32359dc4b5c62c5f" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h4 id="4-2-使用脚本修改文档-了解"><a href="#4-2-使用脚本修改文档-了解" class="headerlink" title="4.2 使用脚本修改文档(了解)"></a>4.2 使用脚本修改文档(了解)</h4><h5 id="4-2-1-Painless简介"><a href="#4-2-1-Painless简介" class="headerlink" title="4.2.1 Painless简介"></a>4.2.1 Painless简介</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Painless 是默认情况下 Elasticsearch 中提供的一种简单，安全的脚本语言</span><br><span class="line">2. 它专门设计用于 Elasticsearch，可以安全地使用内联和存储的脚本，默认情况下启用</span><br></pre></td></tr></table></figure>

<h5 id="4-2-2-Painless使用"><a href="#4-2-2-Painless使用" class="headerlink" title="4.2.2 Painless使用"></a>4.2.2 Painless使用</h5><ul>
<li><p>请求地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1/_update</span><br></pre></td></tr></table></figure></li>
<li><p>请求参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">方式一:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	&quot;script&quot;:&#123;</span><br><span class="line">		&quot;lang&quot;:&quot;painless&quot;,</span><br><span class="line">		&quot;inline&quot;:&quot;ctx._source.age -=10&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二:</span><br><span class="line">&#123;</span><br><span class="line">	&quot;script&quot;:&#123;</span><br><span class="line">		&quot;lang&quot;:&quot;painless&quot;,</span><br><span class="line">		&quot;inline&quot;:&quot;ctx._source.age = params.age&quot;,</span><br><span class="line">		&quot;params&quot;:&#123;</span><br><span class="line">			&quot;age&quot;:21</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>请求图例</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB34be6087739e611fe06d33aa45484568?method=download&shareKey=113ef04dd3a060c0cdd12c2c8c6d392a"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB34be6087739e611fe06d33aa45484568?method=download&shareKey=113ef04dd3a060c0cdd12c2c8c6d392a" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h3 id="第5节-数据删除-postman"><a href="#第5节-数据删除-postman" class="headerlink" title="第5节 数据删除(postman)"></a>第5节 数据删除(postman)</h3><h4 id="5-1-删除文档-postman"><a href="#5-1-删除文档-postman" class="headerlink" title="5.1 删除文档(postman)"></a>5.1 删除文档(postman)</h4><ul>
<li><p>请求地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1</span><br></pre></td></tr></table></figure></li>
<li><p>请求图例</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB378449d8c1de24c0c4ed7e03f35520d0?method=download&shareKey=ff369fc87bb84391a867d031086cf521"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB378449d8c1de24c0c4ed7e03f35520d0?method=download&shareKey=ff369fc87bb84391a867d031086cf521" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h4 id="5-2-删除索引-postman"><a href="#5-2-删除索引-postman" class="headerlink" title="5.2 删除索引(postman)"></a>5.2 删除索引(postman)</h4><ul>
<li><p>请求地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people</span><br></pre></td></tr></table></figure></li>
<li><p>请求图例</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBe87de8b6f23249a84ec971e861a5c4a3?method=download&shareKey=51954b8d182827a566cf1d38bb8b03ed"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBe87de8b6f23249a84ec971e861a5c4a3?method=download&shareKey=51954b8d182827a566cf1d38bb8b03ed" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h4 id="5-3-使用head删除索引"><a href="#5-3-使用head删除索引" class="headerlink" title="5.3 使用head删除索引"></a>5.3 使用head删除索引</h4><ul>
<li>图例演示</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB29862abfb69a19f22949cd6b50687455?method=download&shareKey=aa61c766d5350a9efc8fbd1220c2b07c"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB29862abfb69a19f22949cd6b50687455?method=download&shareKey=aa61c766d5350a9efc8fbd1220c2b07c" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h2 id="第五章-高级查询-Kibana"><a href="#第五章-高级查询-Kibana" class="headerlink" title="第五章 高级查询(Kibana)"></a>第五章 高级查询(Kibana)</h2><h3 id="第1节-Kibana安装"><a href="#第1节-Kibana安装" class="headerlink" title="第1节 Kibana安装"></a>第1节 Kibana安装</h3><h4 id="1-1-Kibana简介"><a href="#1-1-Kibana简介" class="headerlink" title="1.1 Kibana简介"></a>1.1 Kibana简介</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kibana是一个针对Elasticsearch的开源分析及可视化平台,用来搜索、查看交互存储在Elasticsearch索引中的数据.使用Kibana,可以通过各种图表进行高级数据分析及展示</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="1-2-Kibana下载"><a href="#1-2-Kibana下载" class="headerlink" title="1.2 Kibana下载"></a>1.2 Kibana下载</h4><ul>
<li><p>官网地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.elastic.co/cn/kibana</span><br></pre></td></tr></table></figure></li>
<li><p>华为云地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.huaweicloud.com/kibana/6.3.2/kibana-6.3.2-windows-x86_64.zip</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h4 id="1-3-Kibana安装"><a href="#1-3-Kibana安装" class="headerlink" title="1.3 Kibana安装"></a>1.3 Kibana安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、将下载的kibana-6.3.2-windows-x86_64.zip压缩包解压到指定文件夹下</span><br><span class="line">2、在bin目录下D:\soft\kibana-6.3.2-windows-x86_64\bin找到kibana.bat</span><br><span class="line">3、双击运行即可</span><br><span class="line">4、浏览器访问 http://localhost:5601/进入 Dev Tools选项</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="第2节-Kibana使用"><a href="#第2节-Kibana使用" class="headerlink" title="第2节 Kibana使用"></a>第2节 Kibana使用</h3><h4 id="2-1-基本操作"><a href="#2-1-基本操作" class="headerlink" title="2.1 基本操作"></a>2.1 基本操作</h4><h5 id="2-1-1-查看集群健康状态"><a href="#2-1-1-查看集群健康状态" class="headerlink" title="2.1.1 查看集群健康状态"></a>2.1.1 查看集群健康状态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/health?v</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-2-查看节点状态"><a href="#2-1-2-查看节点状态" class="headerlink" title="2.1.2 查看节点状态"></a>2.1.2 查看节点状态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/nodes?v</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-3-查看索引信息"><a href="#2-1-3-查看索引信息" class="headerlink" title="2.1.3 查看索引信息"></a>2.1.3 查看索引信息</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-4-创建索引"><a href="#2-1-4-创建索引" class="headerlink" title="2.1.4 创建索引"></a>2.1.4 创建索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 命令 PUT /book</span><br><span class="line"></span><br><span class="line">2. 返回结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;acknowledged&quot;: true,</span><br><span class="line">  &quot;shards_acknowledged&quot;: true,</span><br><span class="line">  &quot;index&quot;: &quot;book&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-5-删除索引"><a href="#2-1-5-删除索引" class="headerlink" title="2.1.5 删除索引"></a>2.1.5 删除索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 命令  DELETE /book</span><br><span class="line">2. 返回结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;acknowledged&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-6-向文档中添加数据"><a href="#2-1-6-向文档中添加数据" class="headerlink" title="2.1.6 向文档中添加数据"></a>2.1.6 向文档中添加数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /book/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;李雷&quot;,</span><br><span class="line">  &quot;age&quot;:18</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-7-查看文档类型"><a href="#2-1-7-查看文档类型" class="headerlink" title="2.1.7 查看文档类型"></a>2.1.7 查看文档类型</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /book/doc/_mapping</span><br><span class="line"></span><br><span class="line">GET: 请求方式</span><br><span class="line">book: 索引(相当于MYSQL数据库的库名)</span><br><span class="line">doc : 类型(相当于数据库的表名)</span><br><span class="line">_mapping: ES的关键字查询文档类型</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-8-查看索引中的文档-根据ID查询"><a href="#2-1-8-查看索引中的文档-根据ID查询" class="headerlink" title="2.1.8 查看索引中的文档(根据ID查询)"></a>2.1.8 查看索引中的文档(根据ID查询)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /book/doc/1</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-9-更新索引中的文档"><a href="#2-1-9-更新索引中的文档" class="headerlink" title="2.1.9 更新索引中的文档"></a>2.1.9 更新索引中的文档</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /book/doc/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;:&#123;</span><br><span class="line">    &quot;name&quot;:&quot;韩梅梅&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST   : 请求方式</span><br><span class="line">book   : 索引名称</span><br><span class="line">doc    : 类型</span><br><span class="line">1      : 文档id</span><br><span class="line">_update: 关键字,用于更新</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-10-删除索引中的文档"><a href="#2-1-10-删除索引中的文档" class="headerlink" title="2.1.10 删除索引中的文档"></a>2.1.10 删除索引中的文档</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /book/doc/2</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-1-11-对索引中的文档进行批量操作"><a href="#2-1-11-对索引中的文档进行批量操作" class="headerlink" title="2.1.11 对索引中的文档进行批量操作"></a>2.1.11 对索引中的文档进行批量操作</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /book/doc/_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;3&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;: &quot;John Doe&quot; &#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;4&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;: &quot;Jane Doe&quot; &#125;</span><br><span class="line"></span><br><span class="line">_bulk: 批量操作</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="2-2-高级查询"><a href="#2-2-高级查询" class="headerlink" title="2.2 高级查询"></a>2.2 高级查询</h4><h5 id="2-2-1-数据导入"><a href="#2-2-1-数据导入" class="headerlink" title="2.2.1 数据导入"></a>2.2.1 数据导入</h5><ul>
<li><p>数据地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/macrozheng/mall-learning/blob/master/document/json/accounts.json</span><br></pre></td></tr></table></figure></li>
<li><p>导入命令(批量)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/account/_bulk</span><br><span class="line">//这里放上面的数据地址中的数据</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h5 id="2-2-2-高级查询"><a href="#2-2-2-高级查询" class="headerlink" title="2.2.2 高级查询"></a>2.2.2 高级查询</h5><hr>
<h6 id="2-2-2-1-简单搜索"><a href="#2-2-2-1-简单搜索" class="headerlink" title="2.2.2.1 简单搜索"></a>2.2.2.1 简单搜索</h6><ul>
<li><p>搜索全部(match_all)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>分页搜索(from表示偏移量,从0开始,size表示每页显示的数量)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>搜索排序(sort)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">  &quot;sort&quot;: &#123; &quot;balance&quot;: &#123; &quot;order&quot;: &quot;desc&quot; &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">使用sort关键字 以balance字段排序,设置order属性的值为desc倒叙输出</span><br></pre></td></tr></table></figure></li>
<li><p>搜索并返回指定字段内容(_source)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;account_number&quot;, &quot;balance&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_source: 将要查询出来的属性设置到_source数组中</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h6 id="2-2-2-2-条件搜索-match"><a href="#2-2-2-2-条件搜索-match" class="headerlink" title="2.2.2.2 条件搜索(match)"></a>2.2.2.2 条件搜索(match)</h6><ul>
<li><p>搜索出account_number为20的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;account_number&quot;: 20</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>搜索address字段中包含mill的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [</span><br><span class="line">    &quot;address&quot;,</span><br><span class="line">    &quot;account_number&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: 对于数值类型match操作使用的是精确匹配，对于文本类型使用的是模糊匹配</p>
</blockquote>
</li>
</ul>
<hr>
<h6 id="2-2-2-3-短语匹配搜索-match-phrase"><a href="#2-2-2-3-短语匹配搜索-match-phrase" class="headerlink" title="2.2.2.3 短语匹配搜索(match_phrase)"></a>2.2.2.3 短语匹配搜索(match_phrase)</h6><ul>
<li><p>搜索address字段中同时包含mill和lane的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill lane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h6 id="2-2-2-4-组合搜索-bool"><a href="#2-2-2-4-组合搜索-bool" class="headerlink" title="2.2.2.4 组合搜索(bool)"></a>2.2.2.4 组合搜索(bool)</h6><ul>
<li><p>同时满足(must)</p>
</li>
<li><ul>
<li><p>搜索address字段中同时包含mill和lane的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;mill&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;lane&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>满足其中任意一个(should)</p>
</li>
<li><ul>
<li><p>搜索address字段中包含mill或者lane的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;mill&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;lane&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>同时不满足(must_not)</p>
</li>
<li><ul>
<li><p>搜索address字段中不包含mill且不包含lane的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;mill&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;lane&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>满足其中一部分,并且不包含另一部分(组合must和must_not)</p>
</li>
<li><ul>
<li><p>搜索age字段等于40且state字段不包含ID的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;age&quot;: &quot;40&quot; &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;state&quot;: &quot;ID&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<h6 id="2-2-2-5-过滤搜索-filter"><a href="#2-2-2-5-过滤搜索-filter" class="headerlink" title="2.2.2.5 过滤搜索(filter)"></a>2.2.2.5 过滤搜索(filter)</h6><ul>
<li><p>过滤出balance字段在20000~30000的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;balance&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 20000,</span><br><span class="line">            &quot;lte&quot;: 30000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h6 id="2-2-2-6-搜索聚合-aggs"><a href="#2-2-2-6-搜索聚合-aggs" class="headerlink" title="2.2.2.6 搜索聚合(aggs)"></a>2.2.2.6 搜索聚合(aggs)</h6><ul>
<li><p>对state字段进行聚合,统计出相同state的文档数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;:&#123;</span><br><span class="line">    &quot;group_by_state&quot;:&#123;</span><br><span class="line">      &quot;terms&quot;:&#123;</span><br><span class="line">        &quot;field&quot;:&quot;state.keyword&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aggs: 分组聚合关键字</span><br><span class="line">group_by_state: 聚合条件名字,自定义</span><br><span class="line">terms : 关键字,查询某个字段里含有多个关键词的文档</span><br><span class="line">keyword: state是一个关键字类型</span><br></pre></td></tr></table></figure></li>
<li><p>对balance取平均值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;aggs&quot;:&#123;</span><br><span class="line">    &quot;avg_balance&quot;:&#123;</span><br><span class="line">      &quot;avg&quot;:&#123;</span><br><span class="line">        &quot;field&quot;: &quot;balance&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>对state字段进行聚合,统计出相同state的文档数量和balance平均值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;aggs&quot;:&#123;</span><br><span class="line">    &quot;group_by_state&quot;:&#123;</span><br><span class="line">      &quot;terms&quot;:&#123;</span><br><span class="line">        &quot;field&quot;:&quot;state.keyword&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;avg_balance&quot;:&#123;</span><br><span class="line">      &quot;avg&quot;:&#123;</span><br><span class="line">        &quot;field&quot;: &quot;balance&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>具体ES的聚合函数请参考官方文档这里不再讲解</p>
</blockquote>
<hr>
<h2 id="第六章-ES和SpringBoot整合-Spring-data版本使用"><a href="#第六章-ES和SpringBoot整合-Spring-data版本使用" class="headerlink" title="第六章 ES和SpringBoot整合(Spring-data版本使用)"></a>第六章 ES和SpringBoot整合(Spring-data版本使用)</h2><h3 id="第1节-分词器介绍"><a href="#第1节-分词器介绍" class="headerlink" title="第1节 分词器介绍"></a>第1节 分词器介绍</h3><h4 id="1-1-分词器的作用"><a href="#1-1-分词器的作用" class="headerlink" title="1.1 分词器的作用"></a>1.1 分词器的作用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将原始内容进行拆分,将一段话拆分成单词或者一个一个的字,或者语义单元</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="1-2-常见分词器"><a href="#1-2-常见分词器" class="headerlink" title="1.2 常见分词器"></a>1.2 常见分词器</h4><ul>
<li><p>standars</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES默认分词器,将词汇单元转成小写,取出一些停用词和标点符号,支持中文,将中文拆分成单个的字</span><br></pre></td></tr></table></figure></li>
<li><p>IK分词器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个可以很好的支持中文,并且可以自定义的开源分词器</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第2节-standars分词器演示-kibana工具"><a href="#第2节-standars分词器演示-kibana工具" class="headerlink" title="第2节 standars分词器演示(kibana工具)"></a>第2节 standars分词器演示(kibana工具)</h3><h4 id="2-1-演示英文"><a href="#2-1-演示英文" class="headerlink" title="2.1 演示英文"></a>2.1 演示英文</h4><ul>
<li><p>命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;Hello Java&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">将Hello Java分成了两个词分别是hello和java,首字母都变成了小写</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;hello&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;java&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 6,</span><br><span class="line">      &quot;end_offset&quot;: 10,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-演示中文"><a href="#2-2-演示中文" class="headerlink" title="2.2 演示中文"></a>2.2 演示中文</h4></li>
<li><p>命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;我是中国人&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;我&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 1,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;是&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 1,</span><br><span class="line">      &quot;end_offset&quot;: 2,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 3,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;国&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 3,</span><br><span class="line">      &quot;end_offset&quot;: 4,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 4,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第3节-ik分词器安装和使用"><a href="#第3节-ik分词器安装和使用" class="headerlink" title="第3节 ik分词器安装和使用"></a>第3节 ik分词器安装和使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">medcl/elasticsearch-analysis-ik分词器是当前对中文支持最好的分词器</span><br></pre></td></tr></table></figure>

<ul>
<li><p>IK分词器地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/medcl/elasticsearch-analysis-ik/archive/v6.3.2.zip</span><br><span class="line"></span><br><span class="line">下载的分词器一定要和当前安装的ES版本相同</span><br></pre></td></tr></table></figure></li>
<li><p>安装步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 将下载的分词器压缩包复制到我们的es的安装目录D:\soft\elasticsearch-6.3.2\plugins插件目录下</span><br><span class="line">3. 将elasticsearch-analysis-ik解压</span><br><span class="line">4. 重启ES服务</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第4节-ik分词器演示-kibana工具"><a href="#第4节-ik分词器演示-kibana工具" class="headerlink" title="第4节 ik分词器演示(kibana工具)"></a>第4节 ik分词器演示(kibana工具)</h3><ul>
<li><p>命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;我是中国人&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;我是中国人&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>返回效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">ik_smart分词器效果</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;我&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 1,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;是&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 1,</span><br><span class="line">      &quot;end_offset&quot;: 2,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中国人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------------</span><br><span class="line"></span><br><span class="line">ik_max_word分词器效果</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;我&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 1,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;是&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 1,</span><br><span class="line">      &quot;end_offset&quot;: 2,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中国人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中国&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 4,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;国人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 3,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第5节-ES和SpringBoot整合"><a href="#第5节-ES和SpringBoot整合" class="headerlink" title="第5节 ES和SpringBoot整合"></a>第5节 ES和SpringBoot整合</h3><h4 id="5-1-创建SpringBoot项目"><a href="#5-1-创建SpringBoot项目" class="headerlink" title="5.1 创建SpringBoot项目"></a>5.1 创建SpringBoot项目</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">添加依赖,依赖在springboot-data中</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEBf368ecdd8daad54090d49c410f198080?method=download&shareKey=b8d107a550419db9195541167c95628d"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEBf368ecdd8daad54090d49c410f198080?method=download&shareKey=b8d107a550419db9195541167c95628d" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<h4 id="5-2-配置"><a href="#5-2-配置" class="headerlink" title="5.2 配置"></a>5.2 配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 设置ES的节点地址</span><br><span class="line"># spring.data.elasticsearch.cluster-nodes=127.0.0.1:9300,127.0.0.1:9301,127.0.0.1:9302</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=127.0.0.1:9300</span><br><span class="line"># es集群名称</span><br><span class="line">spring.data.elasticsearch.cluster-name=elasticsearch</span><br></pre></td></tr></table></figure>

<h4 id="5-3-常见的操作"><a href="#5-3-常见的操作" class="headerlink" title="5.3 常见的操作"></a>5.3 常见的操作</h4><h5 id="5-3-1-映射ES文档的实体类"><a href="#5-3-1-映射ES文档的实体类" class="headerlink" title="5.3.1 映射ES文档的实体类"></a>5.3.1 映射ES文档的实体类</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @Author 枫桥夜泊1990</span><br><span class="line"> * @BLOG https://hd1611756908.github.io/</span><br><span class="line"> * @BSITE https://space.bilibili.com/514155929/</span><br><span class="line"> * @DATE 2020/8/17</span><br><span class="line"> * Document: 设置文档</span><br><span class="line"> * indexName：设置索引</span><br><span class="line"> * type： 设置类型</span><br><span class="line"> * shards: 设置分片</span><br><span class="line"> * replicas: 设置副本</span><br><span class="line"> */</span><br><span class="line">@Document(indexName = &quot;bank&quot;,type = &quot;account&quot;,shards = 5,replicas = 1)</span><br><span class="line">public class EsAccount &#123;</span><br><span class="line"></span><br><span class="line">    @Id</span><br><span class="line">    private Long id;</span><br><span class="line">    @Field(type = FieldType.Long)</span><br><span class="line">    private Long account_number;</span><br><span class="line">    @Field(type = FieldType.Text) //是有IK分词器(一定要安装IK分词器)</span><br><span class="line">    private String firstname;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String address;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String gender;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String city;</span><br><span class="line">    @Field(type = FieldType.Long)</span><br><span class="line">    private Long balance;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String lastname;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String employer;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String state;</span><br><span class="line">    @Field(type = FieldType.Long)</span><br><span class="line">    private Long age;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-3-2-操作ES的接口"><a href="#5-3-2-操作ES的接口" class="headerlink" title="5.3.2 操作ES的接口"></a>5.3.2 操作ES的接口</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public interface EsAccountRepository extends ElasticsearchRepository&lt;EsAccount,Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据名称查询</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    List&lt;EsAccount&gt; findByLastname(String lastname);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据地址查询</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    List&lt;EsAccount&gt; findByAddress(String address);</span><br><span class="line">    /**</span><br><span class="line">     * 根据名称删除</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    void deleteByFirstname(String firstname);</span><br><span class="line">    /**</span><br><span class="line">     * 根据地址查询,并且分页</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    Page&lt;EsAccount&gt; findByAddress(String address, Pageable pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-3-3-单元测试操作"><a href="#5-3-3-单元测试操作" class="headerlink" title="5.3.3 单元测试操作"></a>5.3.3 单元测试操作</h5><ul>
<li><p>常见操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @Author 枫桥夜泊1990</span><br><span class="line"> * @BLOG https://hd1611756908.github.io/</span><br><span class="line"> * @BSITE https://space.bilibili.com/514155929/</span><br><span class="line"> * @DATE 2020/8/17</span><br><span class="line"> */</span><br><span class="line">public class EsAccountRepositoryTest extends SpringbootEs01ApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private EsAccountRepository esAccountRepository;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试findAll</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findAll1()&#123;</span><br><span class="line">        Iterable&lt;EsAccount&gt; esAccounts = esAccountRepository.findAll();</span><br><span class="line">        //esAccounts.forEach(System.out::println);</span><br><span class="line">        //esAccounts.forEach((x)-&gt;&#123;System.out.println(x);&#125;);</span><br><span class="line">        Iterator&lt;EsAccount&gt; iterator = esAccounts.iterator();</span><br><span class="line">        while (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 测试添加一条数据</span><br><span class="line">     * 更新数据,更新和添加主要判断是否有id</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void saveAccount()&#123;</span><br><span class="line">        EsAccount account = new EsAccount();</span><br><span class="line">        account.setAccount_number(4570L);</span><br><span class="line">        account.setAddress(&quot;北京&quot;);</span><br><span class="line">        account.setAge(18L);</span><br><span class="line">        account.setBalance(1000000L);</span><br><span class="line">        account.setCity(&quot;中国&quot;);</span><br><span class="line">        account.setEmail(&quot;123@.com&quot;);</span><br><span class="line">        account.setEmployer(&quot;李雷&quot;);</span><br><span class="line">        account.setFirstname(&quot;李&quot;);</span><br><span class="line">        account.setGender(&quot;男&quot;);</span><br><span class="line">        account.setId(4570L);</span><br><span class="line">        account.setLastname(&quot;李雷&quot;);</span><br><span class="line">        account.setState(&quot;NL&quot;);</span><br><span class="line">        esAccountRepository.save(account);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据ID查询account</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findAccountById()&#123;</span><br><span class="line">        Optional&lt;EsAccount&gt; esAccount = esAccountRepository.findById(4570L);</span><br><span class="line">        System.out.println(esAccount.get());</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 根据ID删除</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void deleteAccount()&#123;</span><br><span class="line">        esAccountRepository.deleteById(4570L);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void updateAccount()&#123;</span><br><span class="line"></span><br><span class="line">        Optional&lt;EsAccount&gt; esAccount = esAccountRepository.findById(456L);</span><br><span class="line">        EsAccount account = esAccount.get();</span><br><span class="line">        account.setLastname(&quot;李雷super&quot;);</span><br><span class="line">        esAccountRepository.save(account);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据Lastname查询（模糊查询）</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findByLastname()&#123;</span><br><span class="line">        List&lt;EsAccount&gt; accountList = esAccountRepository.findByLastname(&quot;李雷&quot;);</span><br><span class="line">        System.out.println(accountList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据地址查询（模糊查询）</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findByAddress()&#123;</span><br><span class="line">        List&lt;EsAccount&gt; accounts = esAccountRepository.findByAddress(&quot;京&quot;);</span><br><span class="line">        System.out.println(accounts);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 分页查询</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findPage()&#123;</span><br><span class="line">        Pageable p = PageRequest.of(0, 5);</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.findAll(p);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 排序分页查询</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findPageMult()&#123;</span><br><span class="line">        Sort sort = Sort.by(Sort.Direction.DESC, &quot;account_number&quot;);</span><br><span class="line">        Pageable p = PageRequest.of(0, 5, sort);</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.findByAddress(&quot;Place&quot;, p);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 复杂查询,采用search方法</span><br><span class="line">     * 构建条件查询 使用match语法</span><br><span class="line">     * 过滤查询</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMatch01()&#123;</span><br><span class="line">        //单个条件</span><br><span class="line">        // QueryBuilder query = QueryBuilders.matchQuery(&quot;account_number&quot;, 20);</span><br><span class="line">        //多个条件</span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = builder</span><br><span class="line">                            .withQuery(QueryBuilders.matchQuery(&quot;account_number&quot;, 20))</span><br><span class="line">                            .withQuery(QueryBuilders.matchQuery(&quot;firstname&quot;,&quot;Elinor&quot;));</span><br><span class="line">        NativeSearchQuery build = queryBuilder.build();</span><br><span class="line">        Iterable&lt;EsAccount&gt; accounts = esAccountRepository.search(build);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 复杂查询,采用search方法</span><br><span class="line">     * 构建条件查询 使用match语法</span><br><span class="line">     * 短语匹配搜索</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMatchPhrase()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = builder.withQuery(QueryBuilders.matchPhraseQuery(&quot;address&quot;, &quot;mill lane&quot;));</span><br><span class="line">        NativeSearchQuery searchQuery = queryBuilder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accountPage = esAccountRepository.search(searchQuery);</span><br><span class="line">        //accountPage.forEach(System.out::println);</span><br><span class="line">        //accountPage.forEach((x)-&gt;&#123;System.out.println(x);&#125;);</span><br><span class="line">        //获取迭代器</span><br><span class="line">        Iterator&lt;EsAccount&gt; iterator = accountPage.iterator();</span><br><span class="line">        while(iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 组合搜索(bool)</span><br><span class="line">     * 同时满足(must)</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMust()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().must(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;)).must(QueryBuilders.matchQuery(&quot;address&quot;,&quot;lane&quot;)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 满足其中任意一个(should)</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testShould()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().should(QueryBuilders.matchQuery(&quot;address&quot;,&quot;lane&quot;)).should(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;)));</span><br><span class="line">        NativeSearchQuery searchQuery = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(searchQuery);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 同时不满足 must_not</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMustNot()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().mustNot(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;)).mustNot(QueryBuilders.matchQuery(&quot;address&quot;,&quot;lane&quot;)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; search = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount esAccount : search) &#123;</span><br><span class="line">            System.out.println(esAccount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 满足其中一部分,并且不包含另一部分(组合must和must_not)</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMustAndNotMust()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().mustNot(QueryBuilders.matchQuery(&quot;state&quot;,&quot;ID&quot;)).must(QueryBuilders.matchQuery(&quot;age&quot;,&quot;40&quot;)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 过滤搜索 filter</span><br><span class="line">     * 过滤出balance字段在20000~30000的文档</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testFilter()&#123;</span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withFilter(QueryBuilders.boolQuery().filter(QueryBuilders.rangeQuery(&quot;balance&quot;).gte(20000).lte(30000)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>分组聚合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Elasticsearch有一个功能叫做聚合(aggregations),它允许你在数据上生成复杂的分析统计。它很像SQL中的 GROUP BY 但是功能更强大.</span><br><span class="line"></span><br><span class="line">Elasticsearch的聚合中声明了两个概念如下:</span><br><span class="line">   -- Buckets(桶)：满足某个条件的文档集合。</span><br><span class="line">   -- Metrics(指标)：为某个桶中的文档计算得到的统计信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们可以把类似于数据库中的COUNT(*) 看成一个指标</span><br><span class="line">将 GROUP BY 看成一个桶</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate elasticsearchTemplate;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 分组聚合  ElasticsearchTemplate</span><br><span class="line"> * 单个分组聚合</span><br><span class="line"> * 对state字段进行聚合，统计出相同state的文档数量</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void group01()&#123;</span><br><span class="line"></span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    //统计state字段相同数据出现的次数</span><br><span class="line">    TermsAggregationBuilder field = AggregationBuilders.terms(&quot;group_by_state&quot;).field(&quot;state.keyword&quot;);</span><br><span class="line"></span><br><span class="line">    //查询全部</span><br><span class="line">    builder.withQuery(QueryBuilders.matchAllQuery());</span><br><span class="line">    //添加聚合条件</span><br><span class="line">    builder.addAggregation(field);</span><br><span class="line">    //构建</span><br><span class="line">    NativeSearchQuery query = builder.build();</span><br><span class="line">    //查询,采用ElasticsearchTemplate</span><br><span class="line">    Aggregations aggregations = elasticsearchTemplate.query(query, new ResultsExtractor&lt;Aggregations&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Aggregations extract(SearchResponse response) &#123;</span><br><span class="line">            return response.getAggregations();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //转换成map集合</span><br><span class="line">    Map&lt;String, Aggregation&gt; aggregationMap = aggregations.asMap();</span><br><span class="line">    //获取响应的聚合子类group_by_state</span><br><span class="line">    StringTerms groupByState = (StringTerms) aggregationMap.get(&quot;group_by_state&quot;);</span><br><span class="line">    //获取所有的桶</span><br><span class="line">    List&lt;StringTerms.Bucket&gt; buckets = groupByState.getBuckets();</span><br><span class="line">    Iterator&lt;StringTerms.Bucket&gt; iterator = buckets.iterator();</span><br><span class="line">    while (iterator.hasNext())&#123;</span><br><span class="line">        StringTerms.Bucket bucket = iterator.next();</span><br><span class="line">        System.out.println(bucket.getKeyAsString());</span><br><span class="line">        System.out.println(bucket.getDocCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 分组聚合  ElasticsearchTemplate</span><br><span class="line"> * 多个分组聚合</span><br><span class="line"> * 统计出相同state的文档数量，再统计出balance的平均值</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void group02()&#123;</span><br><span class="line"></span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    //统计state字段相同数据出现的次数</span><br><span class="line">    TermsAggregationBuilder field = AggregationBuilders.terms(&quot;group_by_state&quot;).field(&quot;state.keyword&quot;);</span><br><span class="line">    //统计出balance的平均值</span><br><span class="line">    AvgAggregationBuilder field2 = AggregationBuilders.avg(&quot;avg_balance&quot;).field(&quot;balance&quot;);</span><br><span class="line"></span><br><span class="line">    //查询全部</span><br><span class="line">    builder.withQuery(QueryBuilders.matchAllQuery());</span><br><span class="line">    //添加聚合条件</span><br><span class="line">    builder.addAggregation(field);</span><br><span class="line">    builder.addAggregation(field2);</span><br><span class="line">    //构建</span><br><span class="line">    NativeSearchQuery query = builder.build();</span><br><span class="line">    //查询,采用ElasticsearchTemplate</span><br><span class="line">    Aggregations aggregations = elasticsearchTemplate.query(query, new ResultsExtractor&lt;Aggregations&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Aggregations extract(SearchResponse response) &#123;</span><br><span class="line">            return response.getAggregations();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //转换成map集合</span><br><span class="line">    Map&lt;String, Aggregation&gt; aggregationMap = aggregations.asMap();</span><br><span class="line">    //获取响应的聚合子类group_by_state</span><br><span class="line">    StringTerms groupByState = (StringTerms) aggregationMap.get(&quot;group_by_state&quot;);</span><br><span class="line">    //获取响应的聚合子类avg_balance</span><br><span class="line">    InternalAvg avgBalance = (InternalAvg) aggregationMap.get(&quot;avg_balance&quot;);</span><br><span class="line">    //获取所有的桶</span><br><span class="line">    List&lt;StringTerms.Bucket&gt; buckets = groupByState.getBuckets();</span><br><span class="line">    Iterator&lt;StringTerms.Bucket&gt; iterator = buckets.iterator();</span><br><span class="line">    while (iterator.hasNext())&#123;</span><br><span class="line">        StringTerms.Bucket bucket = iterator.next();</span><br><span class="line">        System.out.println(bucket.getKeyAsString());</span><br><span class="line">        System.out.println(bucket.getDocCount());</span><br><span class="line">    &#125;</span><br><span class="line">    //获取指标</span><br><span class="line">    double value = avgBalance.getValue();</span><br><span class="line">    System.out.println(&quot;===&quot;+value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="第七章-ES和MYSQL数据同步"><a href="#第七章-ES和MYSQL数据同步" class="headerlink" title="第七章 ES和MYSQL数据同步"></a>第七章 ES和MYSQL数据同步</h2><h3 id="第1节-logstash简介"><a href="#第1节-logstash简介" class="headerlink" title="第1节 logstash简介"></a>第1节 logstash简介</h3><p>Logstash是一款开源的数据收集引擎，具备实时管道处理能力。简单来说，logstash作为数据源与数据存储分析工具之间的桥梁，结合ElasticSearch以及Kibana，能够极大方便数据的处理与分析。通过200多个插件，logstash可以接受几乎各种各样的数据。包括日志、网络请求、关系型数据库、传感器或物联网等等</p>
<p><a target="_blank" rel="noopener" href="https://note.youdao.com/yws/api/personal/file/WEB324520b8cc6527b409bc9eae1013cf89?method=download&shareKey=63c09a87e26f0185db22078768d8859b"><img "" class="lazyload placeholder" data-original="https://note.youdao.com/yws/api/personal/file/WEB324520b8cc6527b409bc9eae1013cf89?method=download&shareKey=63c09a87e26f0185db22078768d8859b" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></a></p>
<hr>
<h3 id="第2节-logstash下载-6-3-2"><a href="#第2节-logstash下载-6-3-2" class="headerlink" title="第2节 logstash下载(6.3.2)"></a>第2节 logstash下载(6.3.2)</h3><ul>
<li><p>官网地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.elastic.co/cn/downloads/logstash</span><br></pre></td></tr></table></figure></li>
<li><p>华为镜像站</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.huaweicloud.com/logstash/</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第3节-logstash配置-简单配置-单表-多表"><a href="#第3节-logstash配置-简单配置-单表-多表" class="headerlink" title="第3节 logstash配置(简单配置-单表/多表)"></a>第3节 logstash配置(简单配置-单表/多表)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logstash工作时，主要设置3个部分的工作属性。</span><br><span class="line">input：设置数据来源</span><br><span class="line">filter：可以对数据进行一定的加工处理过滤，但是不建议做复杂的处理逻辑。这个步骤不是必须的</span><br><span class="line">output：设置输出目标</span><br></pre></td></tr></table></figure>

<ul>
<li><p>安装/配置步骤(使用单个表生成索引)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 将下载的logstash-6.3.2.zip文件解压到指定位置</span><br><span class="line">2. 创建一个配置文件名字自定义,我命名为 mysql.conf,将自定义配置文件放到指定位置(我放到了D:\soft\logstash-6.3.2\config文件夹下)</span><br><span class="line">3. 在mysql.conf中添加配置信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line">	elasticsearch&#123;</span><br><span class="line">		# 集群地址</span><br><span class="line">		hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">		# 索引名称</span><br><span class="line">		index =&gt; &quot;department&quot;</span><br><span class="line">		# 生成根据dept_id,生成ES的 _id</span><br><span class="line">		document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">		# 类型</span><br><span class="line">		document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4. 启动logstash服务,使用我们自定义的配置启动</span><br><span class="line">    -- 使用cmd命令行定位到当前logstash目录的bin目录下使用命令为: logstash -f ../config/mysql.conf 启动服务 </span><br><span class="line">5. 等待索引创建完成(这种方式为全量方式)</span><br></pre></td></tr></table></figure></li>
<li><p>安装/配置步骤(使用多张表生成索引)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">	# 第1张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;department&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	# 第2张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;student&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM student&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line"></span><br><span class="line">	# 根据jdbc中的type值指定输入的jdbc对应的输出为哪一个elasticsearch</span><br><span class="line">	</span><br><span class="line">	if[type]==&quot;department&quot;&#123;</span><br><span class="line"></span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;department&quot;</span><br><span class="line">			# 生成根据dept_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if[type]==&quot;student&quot;&#123;</span><br><span class="line">		</span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;student&quot;</span><br><span class="line">			# 生成根据student_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;student_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;student_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第4节-logstash配置-其他配置"><a href="#第4节-logstash配置-其他配置" class="headerlink" title="第4节 logstash配置(其他配置)"></a>第4节 logstash配置(其他配置)</h3><ul>
<li><p>官网配置地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.elastic.co/guide/en/logstash/6.3/plugins-inputs-jdbc.html</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h4 id="4-1-使用时间字段进行追踪-一般使用更新时间字段"><a href="#4-1-使用时间字段进行追踪-一般使用更新时间字段" class="headerlink" title="4.1 使用时间字段进行追踪(一般使用更新时间字段)"></a>4.1 使用时间字段进行追踪(一般使用更新时间字段)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">在阿里巴巴嵩山版手册中强调,任何数据库表都必须有创建时间和更新时间字段,都是datetime类型,也就是保存时间为年月日时分秒</span><br><span class="line">input&#123;</span><br><span class="line">	# 第1张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;department&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true,并且指定tracking_column属性,指定哪一列</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;create_time&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\a\\a.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置时间戳</span><br><span class="line">		tracking_column_type =&gt; &quot;timestamp&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department WHERE create_time &gt; :sql_last_value AND create_time &lt; now() ORDER BY create_time desc&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	# 第2张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;student&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;create_time&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\b\\b.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置时间戳</span><br><span class="line">		tracking_column_type =&gt; &quot;timestamp&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM student WHERE create_time &gt; :sql_last_value AND create_time &lt; now() ORDER BY create_time desc&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line"></span><br><span class="line">	# 根据jdbc中的type值指定输入的jdbc对应的输出为哪一个elasticsearch</span><br><span class="line">	</span><br><span class="line">	if[type]==&quot;department&quot;&#123;</span><br><span class="line"></span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;department&quot;</span><br><span class="line">			# 生成根据dept_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if[type]==&quot;student&quot;&#123;</span><br><span class="line">		</span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;student&quot;</span><br><span class="line">			# 生成根据student_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;student_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;student_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-2-使用其他字段进行追踪-设置使用主键进行追踪"><a href="#4-2-使用其他字段进行追踪-设置使用主键进行追踪" class="headerlink" title="4.2 使用其他字段进行追踪(设置使用主键进行追踪)"></a>4.2 使用其他字段进行追踪(设置使用主键进行追踪)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">在修改其他字段进行追踪时,一定不要忘记修改tracking_column_type类型,详情修改请参官网</span><br><span class="line">input&#123;</span><br><span class="line">	# 第1张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;department&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true,并且指定tracking_column属性,指定哪一列</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;dept_id&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\a\\a.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置列的类型</span><br><span class="line">		tracking_column_type =&gt; &quot;numeric&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department WHERE dept_id &gt; :sql_last_value&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	# 第2张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;student&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;student_id&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\b\\b.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置列的类型</span><br><span class="line">		tracking_column_type =&gt; &quot;numeric&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM student WHERE student_id &gt; :sql_last_value&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line"></span><br><span class="line">	# 根据jdbc中的type值指定输入的jdbc对应的输出为哪一个elasticsearch</span><br><span class="line">	</span><br><span class="line">	if[type]==&quot;department&quot;&#123;</span><br><span class="line"></span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;department&quot;</span><br><span class="line">			# 生成根据dept_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if[type]==&quot;student&quot;&#123;</span><br><span class="line">		</span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;student&quot;</span><br><span class="line">			# 生成根据student_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;student_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;student_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>注意: 日常bug记录与采坑指南,如果出现下面的BUG并且在进行配置查找的时候,无论怎么校验都不能从自己的配置中找到错误,但是服务器还启动不起来,那么可以尝试在错误信息中查找关键信息,经过反复校验,如果设置了last_run_metadata_path服务器可以正常启动,如果配置中少了last_run_metadata_path 属性服务器启动失败,就会报如下错误,并且在下面的错误中,有相关信息,我的报错信息如下,关键信息last_run_metadata_path=&gt;”C:\Users\lenovo/.logstash_jdbc_last_run”,说明在上次发生错的时候logstash对我上次的错误信息进行的保存,造成服务器每次启动读取错误信息,造成的服务器启动失败,去指定位置删除即可.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[2020-08-20T02:27:40,897][ERROR][logstash.pipeline        ] Error registering plugin &#123;:pipeline_id=&gt;&quot;main&quot;, :plugin=&gt;&quot;&lt;LogStash::Inputs::Jdbc jdbc_driver_library=&gt;\&quot;D:\\\\\\\\soft\\\\\\\\logstash-6.3.2\\\\\\\\lib\\\\\\\\mysql-connector-java-5.1.47.jar\&quot;, jdbc_driver_class=&gt;\&quot;com.mysql.jdbc.Driver\&quot;, jdbc_connection_string=&gt;\&quot;jdbc:mysql://127.0.0.1:3306/gn_oa\&quot;, jdbc_user=&gt;\&quot;root\&quot;, jdbc_password=&gt;&lt;password&gt;, schedule=&gt;\&quot;* * * * *\&quot;, statement=&gt;\&quot;SELECT * FROM department\&quot;, id=&gt;\&quot;02efb29127a061192768f52b1a09e6638672c521b53edda48b19f6b9880e90d6\&quot;, enable_metric=&gt;true, codec=&gt;&lt;LogStash::Codecs::Plain id=&gt;\&quot;plain_e50f7aa8-3c57-4f33-9000-86265d442ec7\&quot;, enable_metric=&gt;true, charset=&gt;\&quot;UTF-8\&quot;&gt;, jdbc_paging_enabled=&gt;false, jdbc_page_size=&gt;100000, jdbc_validate_connection=&gt;false, jdbc_validation_timeout=&gt;3600, jdbc_pool_timeout=&gt;5, sql_log_level=&gt;\&quot;info\&quot;, connection_retry_attempts=&gt;1, connection_retry_attempts_wait_time=&gt;0.5, last_run_metadata_path=&gt;\&quot;C:\\\\Users\\\\lenovo/.logstash_jdbc_last_run\&quot;, use_column_value=&gt;false, tracking_column_type=&gt;\&quot;numeric\&quot;, clean_run=&gt;false, record_last_run=&gt;true, lowercase_column_names=&gt;true&gt;&quot;, :error=&gt;&quot;can&#x27;t dup Fixnum&quot;, :thread=&gt;&quot;#&lt;Thread:0x703b95e6 run&gt;&quot;&#125;</span><br><span class="line">[2020-08-20T02:27:41,426][ERROR][logstash.pipeline        ] Pipeline aborted due to error &#123;:pipeline_id=&gt;&quot;main&quot;, :exception=&gt;#&lt;TypeError: can&#x27;t dup Fixnum&gt;, :backtrace=&gt;[&quot;org/jruby/RubyKernel.java:1882:in `dup&#x27;&quot;, &quot;uri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/date/format.rb:838:in `_parse&#x27;&quot;, &quot;uri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/date.rb:1830:in `parse&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/plugin_mixins/value_tracking.rb:87:in `set_value&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/plugin_mixins/value_tracking.rb:36:in `initialize&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/plugin_mixins/value_tracking.rb:29:in `build_last_value_tracker&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/inputs/jdbc.rb:216:in `register&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:340:in `register_plugin&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:351:in `block in register_plugins&#x27;&quot;, &quot;org/jruby/RubyArray.java:1734:in `each&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:351:in `register_plugins&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:498:in `start_inputs&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:392:in `start_workers&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:288:in `run&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:248:in `block in start&#x27;&quot;], :thread=&gt;&quot;#&lt;Thread:0x703b95e6 run&gt;&quot;&#125;</span><br><span class="line">[2020-08-20T02:27:41,467][ERROR][logstash.agent           ] Failed to execute action &#123;:id=&gt;:main, :action_type=&gt;LogStash::ConvergeResult::FailedAction, :message=&gt;&quot;Could not execute action: PipelineAction::Create&lt;main&gt;, action_result: false&quot;, :backtrace=&gt;nil&#125;</span><br></pre></td></tr></table></figure>

<p>坚持原创技术分享，您的支持将鼓励我继续创作！</p>
<p>打赏</p>

      </div>
      <div class="post-tags-categories">
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>author:  </strong>YYT</a>
    </li>
    <li class="post-copyright-link">
    <strong>link:  </strong>
    <a href="/2021/08/08/ELK笔记/" target="_blank" title="ELK">https://yingyuntao.github.io/2021/08/08/ELK笔记/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Copyright notice:   </strong>
      All articles on this website, unless otherwise stated, adopt <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      reprint policy. If reproduced, please indicate source!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img lazyload" data-original="/medias/10.jpg" style="background-size: cover; 
      background-position: center center;">
    </div>
    <a href="/2021/08/08/EasyExcel%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" class="post-nav-link">
      <div class="title">
        <i class="fa fa-angle-left"></i> Prev:
        <div class="title-text">EasyExcel</div>
      </div>
      
      <!-- <div class="content">
        第一章 EasyExcel简介123EasyExcel是一个基于Java的简单、省内存的读写Excel的开源项目。在尽可
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img lazyload" data-original="/medias/6.jpg" style="background-size: cover; 
      background-position: center center;">
    </div>
    <a href="/2021/08/08/JDBC%E7%9A%84/" class="post-nav-link">
      <div class="title">
        Next: <i class="fa fa-angle-right"></i>
        <div class="title-text">JDBC</div>
      </div>
      <!-- <div class="content">
        1.1 JDBC是什么1231、JDBC (Java DataBase Connectivity) 是一组用于操作数据库
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-if="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-if="visible">
      <div class="donate-box_close">
        <i class="fa fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          你的赏识是我前进的动力
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-if="tabActive === 'Alipay'">
          <img src="/medias/zfb.jpg" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-if="tabActive === 'WeChatpay'">
          <img src="/medias/wx.jpg" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      
<section id="comments" style="padding: 1em; margin: 15px auto;"
	class="animated bounceInUp">
	<div id="vcomment" class="comment"></div>
</section>
<style>
	#comments {
		background: rgba(255,255,255,0.9);
	}
	#veditor {
		background-image: url('https://img.zcool.cn/community/01a253594c71cfa8012193a329a77f.gif');
		background-size: contain;
		background-repeat: no-repeat;
		background-position: right;
		background-color: rgba(255, 255, 255, 0);
		resize: vertical;
	}
	#veditor:focus{
		background-position-y: 200px;
		transition: all 0.2s ease-in-out 0s;
	}
	#vcomment .vcards .vcard .vh .vhead .vtag.vvisitor {
		background-color: #42b983;
	}
	.v[data-class=v] .vbtn:active, .v[data-class=v] .vbtn:hover {
		color: #42b983;
		border-color: #42b983;
	}
	#vcomment .vcards .vcard .vhead .vsys i {
		display: none;
	}
	/* 底部valine链接 */
	#vcomment .vpower {
		display: none;
	}
	
	/* 底下注释是修改 名称和邮箱和网址输入框的样式 */
	/* #vcomment .vheader {
		display: flex;
		justify-content: space-around;
	}
	
	#vcomment .vheader .vnick {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vmail {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vlink {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	} */

	img.vimg {
		transition: all 1s;
		/* 头像旋转时间为 1s */
	}

	img.vimg:hover {
		transform: rotate(360deg);
		-webkit-transform: rotate(360deg);
		-moz-transform: rotate(360deg);
		-o-transform: rotate(360deg);
		-ms-transform: rotate(360deg);
	}

	#vcomment .vcards .vcard {
		padding: 15px 20px 0 20px;
		border-radius: 10px;
		margin-bottom: 15px;
		box-shadow: 0 0 4px 1px rgba(0, 0, 0, .12);
		transition: all .3s
	}

	#vcomment .vcards .vcard:hover {
		box-shadow: 0 0 8px 3px rgba(0, 0, 0, .12)
	}

	#vcomment .vcards .vcard .vh .vcard {
		border: none;
		box-shadow: none;
	}
</style>
    
  </div>


  </div>

  <!-- 目录 -->
  <!-- 文章详情页右侧目录 -->

  <div class="toc-aside">
    <div class="toc-main">
      <div class="toc-aside-title">
        <i class="fa fa-list-ul" aria-hidden="true"></i><span>catalog</span>
        
          <div class="toc-open-close">catalog</div>
        
      </div>
      <div class="toc-content">
        <div class="toc"></div>
      </div>
    </div>
  </div>
  <!-- js在scripts目录下的的toc.ejs里面 -->
  

  <script>
    function openBtnClickFn () {
      let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
      let open = eval('' || 'true');
      openOrCloseBtn.click(function() {
        if (open === true) {
          $(".toc-aside").css({'width': 0, 'padding': 0});
          $(".toc-content").css({'width': 0});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
          $(".main-content").css({'width': '75%', 'margin': '10px auto'});
          open = false;
        } else {
          $(".toc-aside").css({'width': '300px', 'padding': '0 10px'});
          $(".toc-content").css({'width': '300px'});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
          $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
          open = true;
        }
      });
    };
    openBtnClickFn();
    document.addEventListener('pjax:complete', function () {
      openBtnClickFn();
    })
  </script>


  

  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;" :style="{'background-color': bgColor ? bgColor : 'transparent'}">
    <transition-group tag="ul" :name="names">
        <li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
            <img :src="image" class="bg-swiper-img">
        </li>
    </transition-group>
</div>
<script>
    var vm = new Vue({
        el: '#appBgSwiper',
        data: {
            names: '' || 'fade' || 'fade', // translate-fade fade
            mark: 0,
            img: [],
            bgColor: '',
            time: null
        },
        methods: {   //添加方法
            change(i, m) {
                if (i > m) {
                    // this.names = 'fade';
                } else if (i < m) {
                    // this.names = 'fade';
                } else {
                    return;
                }
                this.mark = i;
            },
            prev() {
                // this.names = 'fade';
                this.mark--;
                if (this.mark === -1) {
                    this.mark = 3;
                    return
                }
            },
            next() {
                // this.names = 'fade';
                this.mark++;
                if (this.mark === this.img.length) {
                    this.mark = 0;
                    return
                }
            },
            autoPlay() {
                // this.names = 'fade';
                this.mark++;
                if (this.mark === this.img.length) {
                    this.mark = 0;
                    return
                }
            },
            play() {
                let bgImgDelay = '' || '180000'
                let delay = parseInt(bgImgDelay) || 180000;
                this.time = setInterval(this.autoPlay, delay);
            },
            enter() {
                clearInterval(this.time);
            },
            leave() {
                this.play();
            }
        },
        created() {
            this.play()
        },
        beforeDestroy() {
            clearInterval(this.time);
        },
        mounted() {
            let prop = ''|| '';
            let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://') 
            if (isImg) {
                let img = prop.split(',');
                let configRoot = '/'
                let arrImg = [];
                img.forEach(el => {
                    var Expression=/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
			        var objExp = new RegExp(Expression);

                    if(objExp.test(el)) {
                        // http or https
                        arrImg.push(el);
                    } else {
                        // 非http or https开头
                        // 本地文件
                        let firstStr = el.charAt(0);
                        if (firstStr == '/') {
                            el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
                        }
                        el = configRoot + el;
                        arrImg.push(el);
                    }
                })
                this.img = arrImg;
            } else {
                this.bgColor = prop;
            }
        }
    })
</script>

<style>
    .bg-swiper-box {
        position: absolute;
        display: block;
        width: 100%;
        height: 100%;
    }
    .bg-swiper-img {
        object-fit: cover;
        width: 100%;
        height: 100%;
    }
</style>

    </main>

    <!-- 页脚 -->
    <div class="footer bg-color">
  <div class="footer-main">
    <div class="link">
      
    </div>
    <div class="footer-copyright">
      <p>Copyright © 2019 - 2020 <a target="_blank" rel="noopener" href="https://github.com/yingyuntao">yingyuntao</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

    </div>
    <div class="footer-custom">
      
    </div>
    <!-- 不蒜子统计 -->
    
      
  <!-- 不蒜子统计 -->
  <span id="busuanzi_container_site_pv">
        <i class="fa fa-eye" aria-hidden="true"></i>Total visits：<span id="busuanzi_value_site_pv"></span> times
  </span>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_uv" style='display:none'>
        <i class="fa fa-users" aria-hidden="true"></i>Number of visitors：<span id="busuanzi_value_site_uv"></span> people
  </span>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>

    
  </div>
</div>


    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fa fa-moon-o" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-lightbulb-o" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-moon-o" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-lightbulb-o" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fa fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>
    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    
    
    <script src="/js/app.js" data-pjax></script>
    
    <!-- 文章目录所需js -->
<link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4',  //headers 
      content = '.post-detail',//文章容器
      idArr = {};  //标题数组以确定是否增加索引id
      //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    tocbot.init(option);
    
  }


  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
    }
  });

  
</script>

<style>
.is-position-fixed {
  position:sticky !important;
  top: 74px;
}
.toc-main ul {
  counter-reset: show-list;
}
.toc-main ul li::before {
  content: counter(item)".";
  display: block;
  position: absolute;
  left: 12px;
  top:0;
}
/* .toc > .toc-list {
  padding-left: 35px;
}
.toc>.toc-list li {
  list-style: decimal;
}
.toc-list {
  padding-left: 25px;
} */
</style> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- div滚动到显示区域的动画 -->

  <script src="/js/aos/aos.js"></script>
  <script>
    // https://github.com/michalsnik/aos
    var themeOffset = parseInt('120') || 120;
    var themeDelay = parseInt('0') || 0;
    var themeDuration = parseInt('400') || 400;
    var themeEasing = 'ease' || 'ease';
    var themeOnce = eval('true') || false;
    var themeMirror = eval('false') || false;
    var themeAnchorPlacement = 'top-bottom' || 'top-bottom';
    AOS.init({
      // Global settings:
      disable: false, // accepts following values: 'phone', 'tablet', 'mobile', boolean, expression or function
      startEvent: 'DOMContentLoaded', // name of the event dispatched on the document, that AOS should initialize on
      initClassName: 'aos-init', // class applied after initialization
      animatedClassName: 'aos-animate', // class applied on animation
      useClassNames: false, // if true, will add content of `data-aos` as classes on scroll
      disableMutationObserver: false, // disables automatic mutations' detections (advanced)
      debounceDelay: 50, // the delay on debounce used while resizing window (advanced)
      throttleDelay: 99, // the delay on throttle used while scrolling the page (advanced)

      // Settings that can be overridden on per-element basis, by `data-aos-*` attributes:
      offset: themeOffset, // offset (in px) from the original trigger point
      delay: themeDelay, // values from 0 to 3000, with step 50ms
      duration: themeDuration, // values from 0 to 3000, with step 50ms
      easing: themeEasing, // default easing for AOS animations
      once: themeOnce, // whether animation should happen only once - while scrolling down
      mirror: themeMirror, // whether elements should animate out while scrolling past them
      anchorPlacement: themeAnchorPlacement, // defines which position of the element regarding to window should trigger the animation

    });

    document.addEventListener('pjax:complete', function () {
      AOS.refresh();
    })
  </script>


<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = 'copy';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fa fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
            // 返回false, 防止重复触发copy事件  
            // return false;
          }
        })
        //  监听 ctrl + c事件  
        // $(document).unbind('keypress').bind('keypress', function (e) {
        //   if (e.ctrlKey && e.keyCode == 67) {
        //     doSomething();
        //     // 返回false, 防止重复触发copy事件  
        //     return false;
        //   }
        // })

        // // 鼠标右键的复制事件  
        // $(document).unbind('copy').bind('copy', function (e) {
        //   doSomething();
        // });

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>


<!-- 图片懒加载 -->
<script src="/js/lazyload/lazyload@1.9.1.js"></script>
<script data-pjax>
  $(function () {
    $("div.lazyload, img.lazyload, a.lazyload").lazyload(
      {
        effect: "show",
        placeholder: "https://img10.360buyimg.com/ddimg/jfs/t1/159345/8/2271/222193/5ff7b36fEe49f5663/a95287c20385127f.gif"    //图片未加载出来时显示的占位图
      }
    );
  });
</script>

<!-- 评论所需js -->

    
        <!-- 弹幕所需的css和js -->
        
<!-- 具体js，请前往valine/script.ejs查看 -->

        <script>
  var requiredFields = '';
  requiredFields = requiredFields.split(',');
  comment_el = '.comment';
  let looperValine = null;
  load_valine = function () {
    if ($(comment_el).length) {
      var valine = new Valine({
        el: '#vcomment',
        path: window.location.pathname,
        notify: false,
        verify: false,
        app_id: "",
        app_key: "",
        placeholder: "客官，说点什么吧",
        avatar: "",
        master: "",   //博主邮箱md5
        tagMeta: ["博主","小伙伴","访客"],     //标识字段名
        friends: "",
        metaPlaceholder: { "nick": "昵称/QQ号", "mail": "邮箱" },
        requiredFields: requiredFields,
        enableQQ: true,
      });
      function debounce(fn) {
        var timerID = null
        return function () {
          var arg = arguments[0]   //获取事件
          if (timerID) {
            clearTimeout(timerID)
          }
          timerID = setTimeout(function () {
            fn(arg)              //事件传入函数
          }, 200)
        }
      }
      //查询评论 valine.Q('*').limit(7) -- 查询所有，限制7条, 下面的的代码是查询当前页面
      var themeDanmu = eval('false');
      var themeLoop = eval('false');
      var themeLooperTime = '5000' || 5000;
      var speed = '40' || 20;
      var isBarrager = true;
      if (themeDanmu == true) {
        do_barrager();
        if ($('.danmuBox').length <= 0) {
          $('.navbar').append('<div class="danmuBox"><div class="danmuBtn open"><span class="danmuCircle"></span><span class="danmuText">弹幕</span></div></div>');
        }
        $('.danmuBtn').on('click', debounce(
          function () {
            if ($('.danmuBtn').hasClass('open')) {
              $('.danmuBtn').removeClass('open')
              clearInterval(looperValine);
              $.fn.barrager.removeAll();
            } else {
              $('.danmuBtn').addClass("open");
              do_barrager();
            }
          }
        ))
      }
      function do_barrager() {
        isBarrager && valine.Q(window.location.pathname).find().then(function (comments) {
          // var num = 0; // 可以记录条数，循环调用的时候只取最新的评论放入弹幕中
          var run_once = true;
          var looper_time = themeLooperTime;
          var total = comments.length;
          // var looper = null;
          var index = 0;
          if (total > 0) {
            barrager();
          } else {
            // 当评论数为0的时候，自动关闭弹幕
            // $('.danmuBtn').removeClass('open');
          }
          function barrager() {
            if (run_once) {
              //如果是首次执行,则设置一个定时器,并且把首次执行置为false
              looperValine = setInterval(barrager, looper_time);
              run_once = false;
            }
            var content = comments[index]._serverData.comment;
            var email = comments[index]._serverData.mail;
            var link = comments[index]._serverData.link;
            var newcontent = content.substring(0, 50).replace(/<[^>]+>/g, "");
            //发布一个弹幕
            const item = {
              img: `https://q1.qlogo.cn/g?b=qq&nk=${email}&s=640`, //图片 
              info: newcontent, //文字 
              href: link, //链接 
              close: true, //显示关闭按钮 
              speed: speed, //延迟,单位秒,默认6 
              color: '#fff', //颜色,默认白色 
              old_ie_color: '#000000', //ie低版兼容色,不能与网页背景相同,默认黑色
            }
            $('body').barrager(item);
            //索引自增
            index++;
            //所有弹幕发布完毕，清除计时器。
            if (index == total) {
              clearInterval(looperValine);
              if (themeLoop === true) {
                setTimeout(function () {
                  do_barrager();
                }, 5000);
              } else {
                $('.danmuBtn').removeClass('open');
              }
              return false;
            }

          }
        })
      }
    }
  };
  $(document).ready(load_valine);
  document.addEventListener('pjax:send', function (e) {
    
  })
  document.addEventListener('pjax:complete', function () {
    load_valine();
  });
</script>
    


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

	
		<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
		<script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
		<script src="/js/cursor/explosion.min.js"></script>
	




    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
  </script>



  </body>
</html>